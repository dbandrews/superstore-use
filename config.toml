# Superstore Agent Configuration
# ===============================
# Centralized settings for browser automation, LLM, and agent behavior.
# Sensitive values (API keys, credentials, proxy) should remain in .env

[app]
# SECURITY: Change this to a unique name for your Modal deployment to prevent URL guessing
name = "superstore-agent"
base_url = "https://www.realcanadiansuperstore.ca/en"

[browser]
# User agent string - configured to mimic Chrome on Linux desktop
user_agent = "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36"

# Stealth arguments to avoid bot detection
stealth_args = [
    "--disable-blink-features=AutomationControlled",
    "--disable-dev-shm-usage",
    "--no-sandbox",
    "--disable-setuid-sandbox",
    "--disable-web-security",
    "--disable-features=IsolateOrigins,site-per-process",
    "--disable-accelerated-2d-canvas",
    "--disable-gpu",
]

# Browser event timeouts (in seconds)
timeout_browser_start = 120
timeout_browser_launch = 120
timeout_browser_state_request = 120

# Local development settings
[browser.local]
headless = false
profile_dir = "./superstore-profile"
window_width = 700
window_height = 700
use_proxy = false
use_stealth = false

[browser.local.timing]
wait_between_actions = 4.0
min_wait_page_load = 2.5
wait_for_network_idle = 2.5

# Modal deployment settings
[browser.modal]
# Run non-headless in xvfb virtual display to avoid bot detection
headless = false
profile_dir = "/session/profile"
fallback_profile_dir = "/app/superstore-profile"
window_width = 1920
window_height = 1080
use_proxy = true
use_stealth = true

# Login task - slower timing for auth server latency
[browser.modal.login]
wait_between_actions = 5.0
min_wait_page_load = 5.0
wait_for_network_idle = 5.0

# Add item task - faster timing for browsing
[browser.modal.add_item]
wait_between_actions = 0.1
min_wait_page_load = 0.1
wait_for_network_idle = 0.1

[llm]
chat_model = "llama-3.3-70b-versatile"
chat_temperature = 0.0
browser_model = "openai/gpt-oss-120b"
browser_use_vision = false

[agent]
max_steps_login = 50
max_steps_add_item = 30
max_steps_checkout = 100
max_steps_place_order = 10
max_steps_view_cart = 20

[prompts]
chat_system = "prompts/chat_system.md"
login = "prompts/login.md"
add_item = "prompts/add_item.md"
checkout = "prompts/checkout.md"
view_cart = "prompts/view_cart.md"

[success_detection]
indicators = [
    "added to cart",
    "add to cart",
    "item added",
    "cart updated",
    "in your cart",
    "added to your cart",
    "quantity updated",
]

[local_cli]
default_monitor_offset = 1080
max_parallel_workers = 4
window_gap = 20
window_y_offset = 50
chrome_lock_files = [
    "SingletonLock",
    "SingletonCookie",
    "SingletonSocket",
    "lockfile",
    "parent.lock",
]

# Human-like typing configuration for credential entry
# These settings control the delays between keystrokes to avoid bot detection
[typing]
min_delay_ms = 50          # Minimum delay between keystrokes (ms)
max_delay_ms = 150         # Maximum delay between keystrokes (ms)
typo_probability = 0.0     # Probability of making a typo (0.0 = never)
pause_probability = 0.1    # Probability of longer pause between characters
pause_min_ms = 200         # Minimum pause duration (ms)
pause_max_ms = 500         # Maximum pause duration (ms)
